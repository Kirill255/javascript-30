<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Type Ahead üëÄ</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <form class="search-form">
    <input type="text" class="search" placeholder="City or State" autofocus>
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>

  <script>
    const searchInput = document.querySelector(".search");
    const suggestions = document.querySelector(".suggestions");

    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
    let cities = [];

    fetch(endpoint)
      .then(res => res.json())
      .then(data => {
        // console.log(data); // –º–∞—Å—Å–∏–≤
        cities = data; // cities.push(...data); –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ —Ç—É–ø–æ –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–æ–∏—Ç—å –∏–ª–∏ –∑–∞–ø—É—à–∏—Ç—å —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
      })
      .catch(console.log);

    const findMatches = (wordToMatch, cities) => {
      return cities.filter(place => {
        // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –∞ –Ω–µ –ª–∏—Ç–µ—Ä–∞–ª —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è /wordToMatch/, —Ç.–∫. wordToMatch —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è
        const pattern = new RegExp(wordToMatch, "gi");
        return place.city.match(pattern) || place.state.match(pattern); // –∏—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤ –≥–æ—Ä–æ–¥–µ –∏–ª–∏ —à—Ç–∞—Ç–µ
      })
    };

    const numberWithCommas = (x) => x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); // –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–∏—Å–ª–æ 645966, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 645,966 –∏–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç 66333 -> 66,333

    // handler for addEventListener
    function displayMatches(e) {
      // console.log(this.value); // e.target.value -> –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–ø—É—Ç–∞
      const matchArray = findMatches(this.value, cities);
      // console.log(matchArray);
      const html = matchArray.map(place => {
        const pattern = new RegExp(this.value, "gi");
        const cityName = place.city.replace(pattern, `<span class="hl">${this.value}</span>`); // –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å–æ–≤–ø–∞–¥–∞—é—â–∏—é —á–∞—Å—Ç—å, –æ–±–æ—Ä–∞—á–∏–≤–∞—è –≤ —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π span, —Ç–æ–µ—Å—Ç—å
        const stateName = place.state.replace(pattern, `<span class="hl">${this.value}</span>`); // –µ—Å–ª–∏ –º—ã –∏—â–µ–º —Å–ª–æ–≤–æ "bos", —Ç–æ –≤ —Å–ª–æ–≤–µ "Boston" —ç—Ç–æ –±—É–¥–µ—Ç <span class="hl">Bos</span>ton

        return `
          <li>
            <span class="name">${cityName}, ${stateName}</span>
            <span class="population">${numberWithCommas(place.population)}</span>
          </li>
        `;
      }).join(""); // map –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤, –∞ –Ω–∞–º –Ω—É–∂–Ω–∞ —Å—Ç—Ä–æ–∫–∞, –ø–æ—ç—Ç–æ–º—É –º—ã join'–∏–º –≤–æ—Ç —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º

      suggestions.innerHTML = html; // –≤—Å—Ç–∞–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ç–∫—É –≤ dom
    }

    searchInput.addEventListener("change", displayMatches);
    searchInput.addEventListener("keyup", displayMatches);

    // input autofocus https://stackoverflow.com/questions/3383429/setting-focus-on-an-html-input-box-on-page-load
  </script>
</body>

</html>
